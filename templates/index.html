<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <div class="logo">
            <h1 style="margin:0; font-size: 1.5rem;"><a href="/home"
                    style="text-decoration:none; color:inherit;">LAKSHMI METAL WORKS</a></h1>
        </div>
        <nav>
            {% if request.cookies.get('admin_session') == 'authenticated' %}
            <span style="margin-right: 1.5rem; color: var(--text-muted); font-size: 0.875rem;">Hi, Admin</span>
            <a href="/admin/dashboard"
                style="margin-right: 1.5rem; color: var(--primary); font-size: 0.875rem; text-decoration: none; font-weight: 600;">Dashboard</a>
            <a href="/change-password"
                style="margin-right: 1.5rem; color: var(--text-muted); font-size: 0.875rem; text-decoration: none; font-weight: 600;">Change
                Password</a>
            <a href="/logout"
                style="margin-right: 1.5rem; color: #ef4444; font-size: 0.875rem; text-decoration: none;">Logout</a>
            {% elif request.cookies.get('user_session') %}
            <span style="margin-right: 1.5rem; color: var(--text-muted); font-size: 0.875rem;">Hi, {{
                request.cookies.get('user_session') }}</span>
            <a href="/change-password"
                style="margin-right: 1.5rem; color: var(--text-muted); font-size: 0.875rem; text-decoration: none; font-weight: 600;">Change
                Password</a>
            <a href="/logout"
                style="margin-right: 1.5rem; color: #ef4444; font-size: 0.875rem; text-decoration: none;">Logout</a>
            {% else %}
            <a href="/login"
                style="margin-right: 1.5rem; color: var(--primary); font-size: 0.875rem; text-decoration: none; font-weight: 600;">Login
                / Sign Up</a>
            {% endif %}
            <a href="/cart" class="btn btn-primary cart-icon">
                üõí <span class="cart-count">{{ cart_count }}</span>
            </a>
        </nav>
    </header>

    <div class="container">
        <div class="search-container">
            <form action="/home" method="get" class="search-form">
                <input type="text" name="q" placeholder="Search products by name..." class="search-input"
                    value="{{ search_query or '' }}">
                <button type="submit" class="btn btn-primary">Search</button>
                {% if search_query %}
                <a href="/home" class="btn" style="background: #e2e8f0; color: var(--text-main);">Clear</a>
                {% endif %}
            </form>
        </div>

        <div class="product-grid">
            {% if not products %}
            <div class="empty-state">
                <div style="font-size: 4rem; margin-bottom: 1rem;">üîç</div>
                <h3>No products found</h3>
                <p style="color: var(--text-muted);">We couldn't find anything matching "{{ search_query }}".</p>
                <a href="/home" class="btn btn-primary" style="margin-top: 1rem;">View All Products</a>
            </div>
            {% endif %}
            {% for product in products %}
            <div class="product-card">
                <div class="product-image-container">
                    {% if product.image_url %}
                    <img src="{{ product.image_url }}" alt="{{ product.name }}">
                    {% else %}
                    <span class="product-placeholder">‚öôÔ∏è</span>
                    {% endif %}
                </div>
                <div class="product-info">
                    <div class="product-name">{{ product.name }}</div>
                    <div class="product-price">‚Çπ{{ "%.2f"|format(product.rate if product.rate else 0) }}</div>
                    <p style="color: var(--text-muted); font-size: 0.875rem;">{{ product.description[:60] }}...</p>
                    <div style="display:flex; gap: 0.5rem; margin-top: 1rem;">
                        <a href="/product/{{ product.id }}" class="btn"
                            style="background: #e2e8f0; color: var(--text-main);">Details</a>
                        <form action="/add-to-cart/{{ product.id }}" method="post">
                            <button type="submit" class="btn btn-primary">Add to Cart</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-brand">LAKSHMI METAL WORKS</div>
            <div class="footer-address">
                SF. No 16 (59/1) Athipalayam Road<br>
                Chinnavedampatti, Coimbatore - 641049
            </div>
            <div class="footer-contact">
                Office: 0422 - 4274216 / 8754980211 | Mobile: 9843410413
            </div>
        </div>
    </footer>

    <script>
        function toggleImages(productId) {
            const front = document.getElementById(`front-${productId}`);
            const back = document.getElementById(`back-${productId}`);
            const btn = event.target;

            if (front.style.display === 'none') {
                front.style.display = 'block';
                back.style.display = 'none';
                btn.innerText = 'View Back';
            } else {
                front.style.display = 'none';
                back.style.display = 'block';
                btn.innerText = 'View Front';
            }
        }
    </script>
</body>

</html>